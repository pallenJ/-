# 게시판

## simple board

1. [개요](#개요)
1. [기본 기능](#기본-기능)

### 개요

Spring MVC 기반의 게시판.
코드로 배우는 스프링 웹 프로젝트를 보고 만들었으며 지금 말하는 것은 회원가입없는 간단한 게시판

### 기본 기능

- 접속시 테이블에 저장된 게시판 글 목록이 페이징 처리되어 화면에 보여짐
- 글혹은 사용자 이름 등으로 검색가능
- 글 작성시 사용자 이름도 입력, 글을 적은 날짜를 DB에 저장하고 수정시 수정 날짜역시 DB에 저장
- 글쓰기, 수정, 삭제 관련 권한은 따로 나눠져있지 않고 누구나 글번호와 날짜와 글쓴이를 제외하고는 누구나 수정이 가능하며 삭제도 가능


### 테이블
- create 쿼리
```sql
CREATE TABLE `tbl_board` (
	`bno` INT(11) NOT NULL AUTO_INCREMENT,
	`title` VARCHAR(200) NOT NULL COLLATE 'utf8_bin',
	`content` VARCHAR(2000) NOT NULL COLLATE 'utf8_bin',
	`writer` VARCHAR(50) NOT NULL COLLATE 'utf8_bin',
	`regdate` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`updateDate` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`replyCnt` INT(11) NOT NULL DEFAULT '0',
	PRIMARY KEY (`bno`)
)
COLLATE='utf8_bin'
ENGINE=InnoDB
AUTO_INCREMENT=0
;
```
- bno는 각 데이터의 고유번호로 primary key, title는 글 제목 

### domain

- VO 클래스(tbl_board의 자료를 담기위한 클래스)
```java
import java.util.Date;
import lombok.Data;

@Data
public class BoardVO {

	private Long bno;
	private String title;
	private String content;
	private String writer;
	private Date regdate;
	private Date updateDate;
	private int replyCnt;
}

```
- 페이징&검색 기능
   1. Criteria 클래스:
   
   시작위치(pageNum)와 가져올 개수(amount) 그리고 검색시 검색 옵션(type)과 검색내용(keyword)를 저장하는 클래스.
   로직 구조가 oracle에 맞춰졌기에 service에서 한번 정제후 mapper로 보냄.
   모든 데이터를 보낸후 시각적으로 페이징 하는 것이 아닌 페이지에 할당된 데이터만 보냄.
   검색옵션의 경우 BoardMapper.xml 에서 확인하여 해당 검색옵션과 키워드에 맞는 데이터만 가져옴.
   차후 만들 다른 기능에도 사용예정.
   
   2. PageDTO 클래스 :
   아래쪽에 페이징 버튼을 위한 클래스.
   다음 버튼 페이지가 있는지 확인하는 prev, next 라는 boolean변수와 
   시작페이지, 끝페이지를 저장하는 int 변수(startPage,endPage) 그리고 현재 위치한
   페이지의 정보가 담긴 Criteria cri변수로 이뤄져 있다. 
   
   > 소스코드
```java
import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Setter
@Getter
@ToString
public class Criteria {
	private int pageNum;
	private int amount;
	
	private String type;
	private String keyword;
	public Criteria(int pageNum, int amount) {
		super();
		this.pageNum = pageNum;
		this.amount = amount;
	}
	public Criteria(int pageNum, int amount,String type, String keyword) {
		super();
		this.pageNum = pageNum;
		this.amount = amount;
		this.type   = type;
		this.keyword = keyword;
	}
	public Criteria() {
		this(1,10);
	}
	
	public String[] getTypeArr() {
		return type == null? new String[]{}: type.split("");
	}
	
}
```

```java
import lombok.Data;

@Data
public class PageDTO {

	private int startPage;
	private int endPage;
	private boolean prev, next;
	
	private int total;
	private Criteria cri;
	
	public PageDTO(int total, Criteria cri) {
		super();
		this.total = total;
		this.cri = cri;
		
		this.endPage = (int)(Math.ceil(cri.getPageNum()/10.0))*10;
		this.startPage = endPage - 9;
		
		int realEnd = (int)(Math.ceil(total*1.0))/cri.getAmount()+(total%10==0?0:1);
		
		if(realEnd < this.endPage) {
			this.endPage = realEnd;
		}
		this.prev = this.startPage>1;
		this.next = this.endPage  <realEnd;
	}
	
	
	
}
```

### mapper

- 모든 리스트를 가져오는 메소드, 페이징을 적용시킨 메소드, 데이터 추가, 삭제, 검색시 데이터 수를 가져오는 메소드로 구성되어 있다.
- 추후 댓글 추가후엔 댓글 개수를 업데이트 하는 메소드도 



