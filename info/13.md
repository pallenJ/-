# 13

[이전](./12.md)|[index 페이지로](./00index.md) |[다음](./14.md)
---|---|---
<hr>

### 목차

1. [CSRF](#CSRF) 
1.
1.

### CSRF

- CSRF 공격(Cross Site Request Forgery)은 웹 어플리케이션 취약점 중 하나로 인터넷 사용자(희생자)가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 만드는 공격이다.

- CSRF를 통해 해커는 희생자의 권한을 도용하여 중요 기능을 실행하는 것이 가능하다. 와닿게 예시를 들어본다면 페이스북에 희생자의 계정으로 광고성 글을 올리는 것 같은걸 생각하면 된다.(설명을 위한 단순한 예시.)

- CSRF는 해커가 사용자PC를 감염시키거나 서버를 해킹해서 이루어 지는것이 아니며 다음 두가지 조건이 필요하다.

  + 위조 요청을 전송하는 서비스에 희생자가 로그인 상태
  + 희생자가 해커가 만든 피싱 사이트에 접속

- 페이스북, 구글 등 PC에서 자동로그인이 설정되어 있는 사용자가 많고 스팸팝업광고나 피싱메일, 19금사이트 등을 통해 접속될 수 있다.<br>
또한 해커가 만든 피싱 사이트를 하지 않더라도 해커가 XSS 공격을 성공한 정상 사이트를 통해 CSRF 공격이 수행될 수 도 있다.

- 이런 CSRF 공격을 막기위한 방법들은 다음과 같다.
  
  + Referrer 검증
    
    Back-end 단에서 request의 referrer를 확인하여 domain 이 일치하는 지 검증하는 방법.<br> 
    일반적으로 referrer 검증만으로 대부분의 CSRF 공격을 방어할 수 있다. 하지만 같은 도메인 내의 페이지에 XSS 취약점이 있는 경우 CSRF 공격에 취약해질 수 있다.<br> 
    domain 단위 검증에서 좀 더 세밀하게 페이지 단위까지 일치하는지 검증을 하면 도메인 내의 타 페이지에서의 XSS 취약점에 의한 CSRF 공격을 방어할 수 있다.

  + Security Token 사용 (A.K.A CSRF Token)
    
    Referrer 검증이 불가한 환경이라면, Security Token를 활용할 수 있다. <br>우선 사용자의 세션에 임의의 난수 값을 저장하고 사용자의 요청 마다 해당 난수 값을 포함 시켜 전송시킨다.<br> 이후 Back-end 단에서 요청을 받을 때마다 세션에 저장된 토큰 값과 요청 파라미터에 전달되는 토큰 값이 일치하는 지 검증하는 방법이다. 그러나 이 방법도 결국 같은 도메인 내에 XSS 취약점이 있다면 CSRF 공격에 취약해진다.
  
  + Double Submit Cookie 검증

    Double Submit Cookie 검증은 Security Token 검증의 한 종류로 세션을 사용할 수 없는 환경에서 사용할 수 있는 방법이다.<br>
    웹브라우저의 Same Origin 정책으로 인해 자바스크립트에서 타 도메인의 쿠키 값을 확인/수정하지 못한다는 것을 이용한 방어 기법이다.<br>
    스크립트 단에서 요청 시 난수 값을 생성하여 쿠키에 저장하고 동일한 난수 값을 요청 파라미터(혹은 헤더)에도 저장하여 서버로 전송하며 서버단에서는 쿠키의 토큰 값와 파라미터의 토큰 값이 일치하는 지만 검사하면 된다.<br> 
    서버에 따로 토큰 값을 저장할 필요가 없어 위에서 살펴본 세션을 이용한 검증보다 개발 공수가 적은 편이다. 피싱 사이트에서는 도메인이 달라 웹사이트에 쿠키에 값을 저장하지 못하므로 가능한 방어 기법이다.




[이전](./12.md)|[index 페이지로](./00index.md) |[다음](./14.md)
---|---|---
